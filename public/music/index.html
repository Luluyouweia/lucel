<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<meta charset="utf-8">
	<title>鹿鹿音乐</title>
	<style>
	*{
		margin: 0;padding: 0;
		box-sizing: border-box;
		font-family: "Droid Sans Fallback";
		font-weight: 300;color: #000;
	}
	html,body{
		background: rgb(244,244,244);margin: 0;padding: 0;
	}
	#topbar{
		background: rgb(39,39,39);
		position: fixed;text-align: center;top: 0;left: 0;
		width: 100vw;padding: 9px 0;
		color: #eee;height: 50px;
		font-weight: 200;z-index: 8;
	}
	.show-bar{
		width: 90vw;height: 40vw;margin: 15px auto;
		border: 1px solid #000;border-radius: 8px;
	}
	#page{
		position: relative;
	}
	.content{
		display: inline-block;
		width: 45%;margin: 6px 2.5%;height: 30vw;
		background: #fff;padding: 12px;
		border: 1px solid #eee;border-radius: 8px;
		position: relative;background-size: 100%;
		z-index: 0;
	}
	.content .init{
		position: absolute;width: 100%;height: 100%;top: 0;left: 0;
		padding: 12px;background: rgb(255,255,255,0.5);
		overflow: hidden;transition: 0.6s;
	}
	#music{
		position: fixed;bottom: 0;width: 100vw;padding: 3px 20px;
		background: #fff;display: flex;justify-content: space-around;
		border-top: 1px solid #eee;
		z-index: 9;
	}
	#music *{
		color: #fff;display: inline-block;font-size: 10px;font-weight: 200;
	}
	
	#tools{
		width: 100vw;display: flex;
		background: #fff;border-bottom: 1px solid #eee;
		position: fixed;top: 50px;height: 30px;
		overflow-x: auto;padding: 1px 5px;
		z-index: 8;
	}
	#tools li{
		display: inline-block;margin: 1px 15px;white-space: no-warp;
		flex: 0 0 auto;font-size: 14px;font-weight: 300;
	}
	.text244{
		color: rgb(122,122,122);
	}
	.c-text{
		text-align: center;
	}
	#player{
		width: 100vw;height: 100vh;
		position: fixed; top: 160vh;left: 0;
		background-color: rgb(255,255,255,0.7);
		background-size: cover;background-repeat: no-repeat;
		transition: 1s;display: block;background-position: center;
		z-index: 8;
	}
		#boardMusicTitle{
			display: block;width: 100vw;text-align: center;
			margin: 10vh auto 8px; font-size: 28px;max-height: 19vh;
			padding: 30px;background: rgb(255,255,255,0.5);z-index: 9px;
		}
	#playerBG{
		background-repeat: no-repeat;background-size: 100%;	
	}
	audio::-webkit-media-controls-time-remaining-display{
		color: #9cf;/*后数*/
	}
	audio::-webkit-media-controls-current-time-display{
		color: #08f;/*前数*/
	}
	audio::-webkit-media-controls-play-button{
		color: #08f;
	}
	.back{
		display: block;position: absolute;
		background: none;font-weight: 200;transition: 0.3s;border-radius: 50%;
		width: 50px;height: 50px;font-size: 13px;text-align: center;border: none;padding: 15px;
		outline: none;background: rgb(255,255,255,0.3);
	}
	.back:hover{
		background: rgb(255,255,255,0.85);
	}
	.float-around{
		position: fixed;background-color: #fff;
		border-radius: 50%;border: 1px solid rgb(111,111,111);
		width: 50px;height: 50px;font-size: 13px;text-align: center;padding: 15px;
		outline: none;	z-index: 10;	color: #08f;
		right: 18px;bottom: 60px;font-size: 15px;
		visibility: hidden;
	}
	.float-around:hover{background: #eee;}
	.common-button,full-button:hover{
		background: #fff;border: 1px solid #08f;border-radius: 30px;
		outline: none;padding: 10px 18px;height: 48px;color: #08f;text-align: center;
		transition: 0.4s;margin: 8px;
	}
		.full-button,.common-button:hover{
			background: #08f;border: 1px solid #eee;border-radius:  30px;
			outline: none;padding: 10px 18px;height: 48px;color: #fff;text-align: center;
			transition: 0.4s;margin: 8px;
		}
	.space{
		display: flex;justify-content: space-around;width: 100%;
	}
	.space>*{
		display: block;
	}
	.little-float-model-box{
		background: #fff;border: 1px solid #eee;border-radius: 8px;
		padding: 16px;position: fixed;display: block;
		top: 0;bottom: 0;left: 0;right: 0;margin: auto;
		width: 38vw; height: 38vw;overflow: auto;
		max-width: 300px;max-height: 300px;
		font-size: 15px;
		z-index: 29;
	}
	#playerSection{
		width: 100%;top: 3vh;height: 65vh;
		display: block;
		position: relative;
	}
	#playerInner{
		padding: 16px;text-align: center;position: absolute;max-width: 80vw;z-index: 9;
		background-color: rgb(234,234,234,0.35);left: 0;right: 0;margin: auto;border-radius: 6px;
		color: rgb(255, 255, 255);
	}
	#playerInner:hover,#musicUserSelect>*:hover{background-color: rgb(255,255,255,0.6);color: #08f;}
	#musicUserSelect{
		display: flex;justify-content: space-around;
		position: relative;
		bottom: 15vh;width: 100%;
	}
	#musicUserSelect>*{
		font-size: 16px;color:rgb(255, 255, 255);padding: 16px;border-radius: 50%;width: 49px;height: 49px;text-align: center;
	}


	</style>
	<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">		
</head>	
<body onload="checkCookie()">
	<div id="topbar">Lucel Music House <span style="font-size: 8px;color: #eee;">(大多版权来自网易云音乐)</span></div><div style="height: 50px"></div>
		<ul id="tools">
		<li>推荐</li>
		<li>精选</li>
		<li>高级</li>
		<li>流行BGM</li>
		<li>经典</li>
		<li>伤感</li>
		<li>超燃</li>
		<li>搞笑</li>
		<li>电音</li>
		<li>游戏</li>
		<li>动漫</li>	
		<li>原创</li>
	</ul>
	
	<div style="height: 30px"></div>
	
	<div id="page" ></div>
	
	<section id="player">
		<div id="boardMusicTitle">曲目</div>
		<button class="back" style="top: 1.2vh;right: 5vw;" onclick="back('playerScreen')">╳</button>
		<div id="playerBG">
			<section id="playerSection">
				<div id="playerInner"></div>
			</section>
		</div>
		<section id="musicUserSelect">
			<span id="ilike" class="fa fa-heart-o" onclick="addCookie('music',MUSICID)"></span>
			<span id="iclear">2</span>
			<span id="playSet">3</span>
		</section>
	</section>
	
	<button id="listen" class="float-around fa fa-headphones"></button>
	<audio id="music" controls><source src="" type="audio/mp3"></source></audio>
	
	<br><br><br>
	<script src="https://luspecial.vercel.app/music/data.js"></script>
	<script>
	var $=(ele)=>{
		if(document.querySelectorAll(ele).length===1)return document.querySelectorAll(ele)[0];
		return document.querySelectorAll(ele);
	}
		//小接口：
			var locateId;//当前正在播放的音乐ID
			var thisId;//当前点开页面的Id
			var MUSICID;//This id;

			var user={
				listened:0,add:0,settings:0,
				func:{
					addIlike:()=>{
						return;	
					}
				}
			}
		//end
		var setCookie=(cname,cvalue,exdays)=>{
		//@prag: cname: 对象; cvalue: 值,exdays: 天；
		var d = new Date();
		d.setTime(d.getTime()+(exdays*365*24*60*60*1000));
		var expires = "expires="+d.toGMTString();
		document.cookie = cname+"="+cvalue+"; "+expires;
	}
	var getCookie=(cname)=>{
		var name = cname + "=";
		var ca = document.cookie.split(';');
		for(var i=0; i<ca.length; i++) {
		var c = ca[i].trim();
		if (c.indexOf(name)==0) { return c.substring(name.length,c.length); }
	}
	return "";
	}
	var checkCookie=()=>{
		var _main=getCookie("_main");
		if (_main!=""){
			return true;
		}
		else {
			setCookie("_main","1",5);
			setCookie("music",'',5)
		}
	}
	
	var addCookie=(type,value)=>{
		var d = new Date();
		d.setTime(d.getTime()+(3*365*24*60*60*1000));
		var expires = "expires="+d.toGMTString();
		if(type=="music"){
			var obj=getCookie("music");
			if(obj==''){
				var v=value+"&";
				setCookie("music",v,5)
			}else{
				var n=obj.split("&");
				var len=n.length;
				console.log('music.cookie.length:',len,"they are",document.cookie);
				for(let i=0;i<len;++i){
					if(n[i]==value){
						var nlen=n[i].length;
						newMessage("已取消");
						var text=substring(n[0],n[nlen]);
						obj.replace(text,'');
						break;//停止循环
						return;//结束
					}
					//检测是否已经被添加
				}
				var newData=getCookie("music")+value+"&";
				obj.replace(getCookie("music"),newData);
			}
		}
		return document.cookie;
	}

		function play(n){
				//Debuger:
				console.log("Cookie",document.cookie);
			if(($("#music").src)!=("https://music.163.com/song/media/outer/url?id="+data[n].id))
			{
				listen();
				if(data[n].id){
					$("#music").src="https://music.163.com/song/media/outer/url?id="+data[n].id;
				}else{
					$("#music").src=data[n].mid;
				}
			}
			$("#music").play();
			playerDisplay(n);
			$("#listen").style.visibility="hidden";//隐藏音乐浮动图标
			for(let i=0;i<num;++i){
				document.getElementsByClassName("init")[i].style="rgb(255,255,255,0.5);top: 0;"
			}
			document.getElementsByClassName("init")[n].style="background: rgb(255,255,255,0.7);top: 70%;"
			return locateId=n;
		}
		var listen=()=>{
			var t,f;
			$("#music").onloadstart=()=>{
				f=1;
			}
			$("#music").onprogress=loading(0);
			$("#music").oncanplay=()=>f=0;removeLoading(0);
			var t=setTimeout(()=>{
				if(f==1)loading(1);f=0;removeLoading(0);
			},20000)
		}
		function playerDisplay(i){
			//@  i: data序列
			$("#player").style.backgroundImage="url("+data[i].img+")";
			$("#player").style.top=0;
			$("#boardMusicTitle").innerHTML=data[i].title;
			$("#playerInner").innerHTML="描述："+data[i].text;

			var n=getCookie("music").split("&");
				var len=n.length;
				console.log('music.cookie.length:',len)
				for(let v=0;v<len;++v){
					if(n[v]==data[i].d){
						$("#ilike").className="fa fa-heart";
						$("#ilike").style.color="red";
						break;
					}
				}
			thisId=i;MUSICID=data[i].d;
			return true;
		}

		for(let i=0;i<data.length;++i){
			//var type=data[i].type.split(";");var len=type.length;console.log(len)
			data[i].d=i;//LUCEL下的ID
			var bg="<div class='content' onclick='play("+i+")' style='background-image:url("+data[i].img+")'><div class='init'>";
			var title="<h3>"+data[i].title+"</h3>";
			var text="<div class='text244'>"+data[i].text+"</div></div>";
			$("#page").innerHTML+=bg+title+text;
		}

		var back=(obj)=>{
			if(obj=="playerScreen"){
				$("#player").style.top="160vh";
				$("#listen").style.visibility="visible";

				$("#ilike").className="fa fa-heart-o";
				$("#ilike").style.color="#fff;"
				return true;
			}
		}

		$("#listen").onclick=()=>{
			$("#listen").style.visibility="hidden";
			playerDisplay(locateId);
		}
	
	//独立区间	{
	var loadingBox=document.createElement("div");
		loadingBox.className="little-float-model-box";
		loadingBox.innerHTML="<h4 class='c-text'>加载中...</h4><div class='space'><button class='common-button' onclick='cancelLocateMusic()' '>取消</button></div>";
	var cannotLoadMusic=document.createElement("div");
		cannotLoadMusic.className="little-float-model-box";
		cannotLoadMusic.innerHTML="<h4>加载失败：超时</h4><div>但我们会试图继续努力加载</div><button onclick='removeLoading(1)' class='full-button'>确认</button>"
		
	var element=document.body; 
	var loading=(i)=>{
		if(i==0)element.appendChild(loadingBox);
		if(i==1)element.appendChild(cannotLoadMusic);
	}
	
	var removeLoading=(i)=>{
		if(i==0){element.removeChild(loadingBox);}
		else if(i==1){element.removeChild(cannotLoadMusic)};

	}
		var messageBox=document.createElement("div");
			messageBox.className="little-float-model-box";
			messageBox.innerHTML="";
	var newMessage=(msg)=>{
		messageBox.innerHTML=msg;
		element.appendChild(messageBox);
		setTimeout(()=>{
			element.removeChild(messageBox);
			messageBox.innerHTML="";
		},4000)
	}
	
	//end	}
	var cancelLocateMusic=()=>{
		$("#music").src="";
		removeLoading(0);
	}

	const num=document.getElementsByClassName("init").length;//@play using;
	//Devlopper Useing Function
		var clearCookie=()=>{
			var d = new Date();
			d.setTime(d.getTime()+(1*-365*24*60*60*1000));
			var expires = "expires="+d.toGMTString();
			document.cookie = expires;
		}

	//Pack Func 执行区域：
	checkCookie();

	</script>
</body>
</html>